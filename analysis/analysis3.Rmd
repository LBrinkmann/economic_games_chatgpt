---
title: "Social Preferences of ChatGPT - Analysis 3"
output: html_document
date: "2023-06-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load required libraries
library(apaTables)
library(dplyr)
library(flextable)
library(ggplot2)
library(ggpubr)
library(kableExtra)
library(knitr)
library(pander)
library(papaja)
library(rempsyc)
library(tidyverse)

# Define theme for plots
my_theme <- function() {
  theme(legend.position = "none",
        plot.title = element_text(size = 12, face = "bold", margin = margin(b = 15)),
        plot.subtitle = element_text(size = 11, face = "italic", margin = margin(b = 15)),
        plot.background = element_rect(fill = "white"),
        panel.background = element_rect(fill = "white"),
        axis.line = element_line(color = "black"),
        plot.margin = margin(20, 5, 5, 5, "pt"),
        plot.title.position = "plot")
}

# Set Working Directory to Source File Directory
getwd()
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

#### PREPROCESSING ####
# Load data
data <- read.csv("data_clean.csv")

# convert to factors
data$temperature <- factor(data$temperature)
data$age <- factor(data$age)
data$gender <- factor(data$gender)
data$prompt_type <- factor(data$prompt_type)
data$game_type <- factor(data$game_type)

# subset with only DG_sender and DG_reciprocity data
data_A3 <- subset(data, game_type %in% c("ultimatum_receiver", "dictator_binary"))
data_A3$game_type <- droplevels(data_A3$game_type) # drop empty factor levels in subset_data
data_A3$game_type <- factor(data_A3$game_type, levels = c("ultimatum_receiver", "dictator_binary"), labels = c("UG Receiver", "DG Binary")) # rename levels for table

# create dummy variable(s)
# data_A3$game_type_num <- ifelse(data_A3$game_type == "DG Sender", 1, 0)
# unocmment and add more if necessary 

```

This document includes the pre registered analysis as well as subsequent exploratory analysis regarding question 3:  
*Are ChatGPT's suggestions to accept/reject offers sensitive to fairness and reflect costly punishment.*

##### Structure
* Descriptives
* Pre-registered analysis
* Exploratory analysis

The pre-registration can be found under this [link](https://aspredicted.org/see_one.php).

The following code uses the preprocessed data from XXX (see XXX; [link](XXX)).

### Descriptives

Descriptive summary of the number of trials and of the dependent variable (XXX).

```{r, fig.asp = 0.8, fig.width = 6, echo=FALSE}

# Calculate the counts per game type and prompt type
total_counts <- data_A3 %>%
  group_by(game_type, prompt_type) %>%
  summarise(Counts = n(), .groups = "keep") %>%
  pivot_wider(names_from = prompt_type, values_from = Counts, values_fill = 0) %>%
  mutate(`Counts Total` = `baseline` + `experimental`) %>%
  rename(`Game type` = game_type, `Counts Baseline` = `baseline`, `Counts Experimental` = `experimental`)

names(total_counts) <- c("Game type", "N Unprompted Demographics", "N Experimental", "N Total")

nice_table(total_counts,
          title = c("Table 1", "Trials per Game Type"),
          note = c(
             "DG = Dictator Game; UG = Ultimatum Game; Unprompted Demographics: demographics were not manipulated, Experimental: demographics of the person receiving the suggestion were manipulated")
          )

# Calculate standard descriptives of the DV
descriptive_stats <- data_A3 %>%
  group_by(game_type) %>%
  summarize(
    Mean = mean(value),
    Median = median(value),
    SD = sd(value),
    Min = min(value),
    Max = max(value)
  )
# print(descriptive_stats)

names(descriptive_stats) <- c("Game type", "Mean", "Median", "SD", "Min", "Max")

n_ug_receiver <- total_counts$`N Total`[total_counts$`Game type` == "UG Receiver"]
n_dg_binary <- total_counts$`N Total`[total_counts$`Game type` == "DG Binary"]
note <- paste("DG = Dictator Game; UG = Ultimatum Game; N (UG Receiver) =",n_ug_receiver, "; N (DG Binary) =", n_dg_binary)

nice_table(descriptive_stats, 
           title = c("Table 2", "Descriptives of Dependent Variable (Money sent by model)"),
           note = note
           )

# plot the DV
# standard error
mean_se <- data_A3 %>%
  group_by(game_type) %>%
  summarize(
    Mean = mean(value),
    SE = sd(value) / sqrt(n())
  )

# Plot
Fig1 <- ggplot(mean_se, aes(x = game_type, y = Mean)) +
  geom_col(fill = "steelblue", width = 0.4) +
  geom_errorbar(aes(ymin = Mean - SE, ymax = Mean + SE), width = 0.15, color = "black") +
  labs(x = "Game Type", y = "Mean Money Sent") +
  scale_y_continuous(limits = c(0, 10)) +
  my_theme() +
  ggtitle("Figure 1") +
  labs(subtitle = "Mean Money Sent by Model")
print(Fig1)

# Alternative plot
Fig1 <- ggboxplot(data_A3, x = "game_type", y = "value", 
          color = "game_type", palette = c("#00AFBB", "#E7B800"), width = 0.5,
          ylab = "Money Sent", xlab = "Game Type") +
          labs(title = "Figure 1", subtitle = "ALTERNATIVE PLOT Mean Money Sent by Model") +
          my_theme() 
print(Fig1)

# save as pdf
pdf("analysis3_figure1.pdf", width = 6, height = 4)
print(Fig1)
dev.off()

```

### Pre-registered analysis

As stated in our pre-registration: 
To answer question 3, we use a z-test to compare whether the likelihood of rejection of unfair offers (i.e., X = 1; X = 2, and X = 3) is higher in the UG receiver compared to Binary DG. Moreover, we will use a Linear Probability Model (and logit, probit for robustness) with the choice of the option that gives both agents zero euros as the dependent variable to study whether: (i) rejection rates are decreasing in the fairness of the offer; and (ii) rejections rates are significantly lower in the Binary DG (compared to UG receiver) for low, but not for high offers (regression will exclude data with X = 10).

##### Test assumptions:
```{r, fig.asp = 0.8, fig.width = 6, echo=FALSE}

#TODO

```

##### Results:  
```{r, fig.asp = 0.8, fig.width = 6, echo=FALSE}

#TODO

```

### Exploratory analysis
```{r, fig.asp = 0.8, fig.width = 6, echo=FALSE}

#TODO

```




